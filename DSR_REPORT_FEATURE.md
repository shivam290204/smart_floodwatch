# Daily Situation Report (DSR) - PDF Generation Feature

## Overview
The **Daily Situation Report (DSR)** feature allows Delhi Government officials (JEs and SDMs) to generate professional PDF reports instantly from the flood management dashboard. This saves hours of manual documentation work.

## Files Created

### 1. `src/services/reportService.js`
**Purpose**: Core PDF generation logic using jsPDF and jsPDF-autotable

**Main Functions**:
- `generateDailyReport()`: Creates the PDF document with all sections
- `downloadDailyReport()`: Triggers browser download with proper filename

**Report Structure**:
```
├── Header
│   ├── Organization Name: "MUNICIPAL CORPORATION OF DELHI"
│   ├── Date & Time (Top Right)
│   └── Title: "DAILY FLOOD SITUATION REPORT (DSR)"
├── Watermark: "CONFIDENTIAL / OFFICIAL USE ONLY" (faint gray, diagonal)
├── Executive Summary
│   ├── Total Rainfall (24h)
│   ├── Active Critical Wards
│   ├── Response Teams Deployed
│   ├── Active Complaints
│   ├── Pump Stations Operational
│   └── System Utilization Rate
├── Ward Status Table
│   └── 6 sample wards with Risk Level, Rainfall, Status
│       (High Risk rows displayed in red text)
└── Footer
    ├── "Generated by Jal Nivaran Portal v2.0"
    └── Signature line: "Chief Engineer (Drainage)"
```

### 2. `src/components/DownloadReportBtn.jsx`
**Purpose**: UI button component for triggering PDF download

**Styling**:
- Color: Dark Gray/Black (`bg-gray-800`)
- Icon: Download icon from lucide-react
- Text: "Download DSR (PDF)"
- Hover effect with shadow and scale animation
- Professional utility tool appearance

## Installation

### Prerequisites
Ensure the following packages are installed in your project:

```bash
npm install jspdf jspdf-autotable lucide-react
```

If not already installed, run:
```bash
cd e:\Smart\smart-floodwatch
npm install jspdf jspdf-autotable
```

## Usage

### In Dashboard Component
The button is already integrated into the Dashboard header:

```jsx
import DownloadReportBtn from './DownloadReportBtn';

// In your component JSX:
<div className="flex items-center justify-between">
  <h2>Dashboard Title</h2>
  <DownloadReportBtn />
</div>
```

### Standalone Usage
```jsx
import DownloadReportBtn from '../components/DownloadReportBtn';

export default function MyComponent() {
  return (
    <div>
      <DownloadReportBtn />
    </div>
  );
}
```

### Direct Function Call
```jsx
import { downloadDailyReport } from '../services/reportService';

// Trigger download programmatically
downloadDailyReport();
```

## PDF Output Example

**Filename Format**: `MCD_Flood_Report_DD-MM-YYYY.pdf`

Example: `MCD_Flood_Report_05-01-2026.pdf`

**Design Features**:
- ✅ Professional bureaucratic appearance (Times New Roman-style, black & white)
- ✅ Stark table borders and rigid structure
- ✅ Not colorful or "techy" - official government document style
- ✅ Watermark for confidentiality marking
- ✅ Proper header with organization details
- ✅ Risk level indicators (red text for "High Risk" rows)
- ✅ Footer with signature line for official signing

## Customization

### To Modify Report Content
Edit `src/services/reportService.js`:

1. **Change Executive Summary Data**:
   ```javascript
   const mockData = {
     avgRainfall: 152.4,
     criticalWards: 8,
     // ... modify values here
   };
   ```

2. **Update Ward Data**:
   ```javascript
   const wardData = [
     {
       wardId: 'W-001',
       location: 'Karol Bagh',
       // ... modify ward information
     }
   ];
   ```

3. **Customize Styling**:
   - Change fonts: Modify `pdf.setFont()`
   - Change colors: Modify `pdf.setTextColor()` and `pdf.setDrawColor()`
   - Change layout: Adjust `yPosition` variables and margins

### To Modify Button Appearance
Edit `src/components/DownloadReportBtn.jsx`:

```jsx
className={`
  flex items-center gap-2 px-4 py-2.5 
  bg-gray-800 hover:bg-gray-900  // Change these colors
  text-white font-semibold 
  rounded-md transition-all duration-200
  ${className}
`}
```

## Features

✅ **Client-Side Generation**: No backend required - all PDF creation happens in the browser
✅ **Instant Download**: Automatic download with proper filename and date
✅ **Professional Format**: Government-grade document styling
✅ **Dynamic Data**: Can be connected to real dashboard data
✅ **Error Handling**: Try-catch block with user feedback
✅ **Responsive**: Works on all devices
✅ **Accessibility**: Proper ARIA labels and title attributes

## Browser Compatibility

- ✅ Chrome/Edge (Latest)
- ✅ Firefox (Latest)
- ✅ Safari (Latest)
- ✅ Mobile browsers (iOS Safari, Chrome Mobile)

## Troubleshooting

### PDF Not Downloading
1. Check browser console for errors (F12)
2. Ensure jsPDF and jsPDF-autotable are installed
3. Clear browser cache and reload

### Watermark Not Visible
- Watermark is intentionally very faint (opacity: 0.15)
- This is normal for official documents
- Adjust opacity in `generateDailyReport()` if needed

### Table Formatting Issues
- Update jsPDF version: `npm install --save-dev jspdf@latest jspdf-autotable@latest`

## Future Enhancements

- [ ] Connect to real dashboard data (instead of mock data)
- [ ] Add multiple pages for large reports
- [ ] Export in other formats (Excel, CSV)
- [ ] Schedule automatic report generation at 5:00 PM
- [ ] Email delivery to officials
- [ ] Report archiving and history
- [ ] Digital signature support

## Support
For issues or feature requests, contact the Jal Nivaran development team.
